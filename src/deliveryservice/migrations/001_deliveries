
-- A Rider can has many orders to delivery
-- OrderID is generated from OrderService(Mongo ObjectID 12bytes)
CREATE TABLE IF NOT EXISTS deliveries(
    id                  INT NOT NULL AUTO_INCREMENT,
    order_details_id    VARCHAR(12) NOT NULL,
    rider_id            INT UNIQUE,
    create_time         TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deliver_time        TIMESTAMP NULL,
    PRIMARY KEY(id)
    FOREIGN KEY (order_details_id)
        REFERENCES order_details(id)
        ON UPDATE CASCADE
        ON DELETE CASCADE
    FOREIGN KEY (rider_id)
        REFERENCES riders(id)
        ON UPDATE CASCADE
        ON DELETE CASCADE
);

-- TODO: destination might use user_location
CREATE TABLE IF NOT EXISTS order_details (
    id              VARCHAR(12) UNIQUE NOT NULL,
    pickup_code     VARCHAR(3) NOT NULL,
    pickup_location     POINT SRID 0 NOT NULL,
    drop_off_location   POINT SRID 0 NOT NULL,
    status          ENUM('UNACCEPT','ACCEPTED','DELIVERED'),
    accept_time     TIMESTAMP,
    PRIMARY KEY(id)
);


CREATE TABLE IF NOT EXISTS riders (
    id           INT NOT NULL AUTO_INCREMENT,
    phone_Number TEXT NOT NULL,
    PRIMARY KEY(id)
);

