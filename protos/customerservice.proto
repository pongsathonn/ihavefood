syntax = "proto3";

package ihavefood;

option go_package =  "/genproto";

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";
import "common.proto";
import "protoc-gen-openapiv2/options/annotations.proto";


// ---------------------CUSTOMER SERVICE------------------------------
service CustomerService {

    // ListCustomers shows all customers profile.
    rpc ListCustomers(ListCustomersRequest) returns(ListCustomersResponse){
        option (google.api.http) = {get: "/api/customers"};
    }

    // GetCustomer shows a customer profile.
    rpc GetCustomer(GetCustomerRequest) returns(Customer){
        option (google.api.http) = {get: "/api/customers/{customer_id}"};
    }
    
    // CreateAddress creates new address to exists uer customer.
    rpc CreateAddress(CreateAddressRequest) returns(Address){
        option (google.api.http) = {
            post: "/api/customers/{customer_id}/address"
            body: "*"
        };
    }

    rpc UpdateCustomer(UpdateCustomerRequest) returns (Customer){
        option (google.api.http) = {
            patch: "/api/customers/{customer_id}"
            body: "*"
        };
    }

    rpc DeleteCustomer(DeleteCustomerRequest) returns(google.protobuf.Empty){
        option (google.api.http) = {delete: "/api/customers/{customer_id}"};
    }


    // Draft 
    // rpc RenameCustomer(RenameCustomerRequest) returns (RenameCustomerResponse){}
    // rpc ValidateCustomerSocial() returns(){}

}

message Customer {
    string customer_id = 1; 
    string username = 2;
    // bytes picture = 3;
    string bio = 4;
    Social social = 5;
    repeated Address addresses = 6;
    ContactInfo contact = 7;
    google.protobuf.Timestamp create_time = 8;
    google.protobuf.Timestamp update_time = 9;
}

message ContactInfo {
    string phone_number = 1;
    string email = 2;
}

message ListCustomersRequest {
    // TODO filter here
}

message ListCustomersResponse{
    repeated Customer customers = 1;
}

message GetCustomerRequest{
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"customer_id\": \"0cf361e1-4b44-483d-a159-54dabdf7e814\" }"
    };
    string customer_id = 1;
}

message CreateAddressRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"customer_id\": \"0cf361e1-4b44-483d-a159-54dabdf7e814\", \"address\": {\"address_name\": \"Arun House\", \"sub_district\": \"Suthep\", \"district\": \"Mueang Chiang Mai\", \"province\": \"Chiang Mai\", \"postal_code\": \"50200\"}}"
    };    

    string customer_id = 1;
    Address address = 2;
}

message UpdateCustomerRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"customer_id\": \"0cf361e1-4b44-483d-a159-54dabdf7e814\", \"new_username\": \"anurak_new\", \"new_bio\": \"Loves coffee and coding.\", \"new_social\": {\"facebook\": \"anurak.chiangmai\", \"instagram\": \"@anurak_insta\", \"line\": \"@anurak\"}}"
    };

    string customer_id = 1;
    // username must has constraint for update
    // such as update every XX months.
    string new_username = 2;
    //bytes new_picture = 3;
    string new_bio = 4;
    Social new_social = 5;
}

message DeleteCustomerRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"customer_id\": \"0cf361e1-4b44-483d-a159-54dabdf7e814\"}"
    };

    string customer_id = 1;
}



