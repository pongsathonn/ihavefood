syntax = "proto3";

package ihavefood;

option go_package =  "/genproto";

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";
import "common.proto";
import "protoc-gen-openapiv2/options/annotations.proto";


// ---------------------CUSTOMER SERVICE------------------------------
service CustomerService {

    // ListCustomers shows all customers profile.
    rpc ListCustomers(ListCustomersRequest) returns(ListCustomersResponse){
        option (google.api.http) = {get: "/api/admin/customers"};
    }

    // GetCustomer shows a customer profile.
    rpc GetCustomer(GetCustomerRequest) returns(Customer){
        option (google.api.http) = {get: "/api/customers/{customer_id}"};
    }
    
    rpc CreateAddress(CreateAddressRequest) returns(Address){
        option (google.api.http) = {
            post: "/api/customers/{customer_id}/address"
            body: "*"
        };
    }

    rpc UpdateCustomerInfo(UpdateCustomerInfoRequest) returns (Customer) {
      option (google.api.http) = {
        patch: "/api/customers/{customer_id}/info"
        body: "*"
      };
    }
    
    rpc UpdateCustomerSocial(UpdateCustomerSocialRequest) returns (Customer) {
      option (google.api.http) = {
        patch: "/api/customers/{customer_id}/social"
        body: "*"
      };
    }
    
    rpc UpdateCustomerAddress(UpdateCustomerAddressRequest) returns (Address) {
      option (google.api.http) = {
        patch: "/api/customers/{customer_id}/addresses/{address_id}"
        body: "*"
      };
    }

    rpc DeleteCustomer(DeleteCustomerRequest) returns(google.protobuf.Empty){
        option (google.api.http) = {delete: "/api/customers/{customer_id}"};
    }

    rpc DeleteCustomerAddress(DeleteCustomerAddressRequest) returns(google.protobuf.Empty){
        option (google.api.http) = {delete: "/api/customers/{customer_id}/addresses/{address_id}"};
    }


    // Draft 
    // rpc RenameCustomer(RenameCustomerRequest) returns (RenameCustomerResponse){}
    // rpc ValidateCustomerSocial() returns(){}

}

message Customer {
    string customer_id = 1;
    string username = 2;
    string email = 3;
    string phone = 4;
    Social social = 6;
    repeated Address addresses = 7;
    google.protobuf.Timestamp create_time = 8;
    google.protobuf.Timestamp update_time = 9;
    // bytes picture = 10;
}

message ListCustomersRequest {}

message ListCustomersResponse{
    repeated Customer customers = 1;
}

message GetCustomerRequest{
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"customer_id\": \"0cf361e1-4b44-483d-a159-54dabdf7e814\" }"
    };
    string customer_id = 1;
}

message CreateAddressRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"customer_id\": \"0cf361e1-4b44-483d-a159-54dabdf7e814\", \"address\": {\"address_name\": \"Arun House\", \"sub_district\": \"Suthep\", \"district\": \"Mueang Chiang Mai\", \"province\": \"Chiang Mai\", \"postal_code\": \"50200\"}}"
    };    

    string customer_id = 1;
    NewAddress address = 2;
}

message UpdateCustomerInfoRequest {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    example: "{\"customer_id\":\"0cf361e1-4b44-483d-a159-54dabdf7e814\",\"new_username\":\"anurak_new\",\"new_phone\":\"0812345678\"}"
  };

  string customer_id = 1;
  string new_username = 2;
  string new_phone = 3;
  //bytes new_picture = TODO;
}

message UpdateCustomerSocialRequest {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    example: "{\"customer_id\":\"0cf361e1-4b44-483d-a159-54dabdf7e814\",\"new_social\":{\"facebook\":\"anurak.chiangmai\",\"instagram\":\"@anurak_insta\",\"line\":\"@anurak\"}}"
  };

  string customer_id = 1;
  Social new_social = 2;
}

message UpdateCustomerAddressRequest {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    example: "{\"customer_id\":\"0cf361e1-4b44-483d-a159-54dabdf7e814\",\"address_id\":\"111361e1-2244-483d-2259-8888bdf7e814\",\"address\":{\"address_name\":\"Home\",\"sub_district\":\"Suthep\",\"district\":\"Mueang Chiang Mai\",\"province\":\"Chiang Mai\",\"postal_code\":\"50200\"}}"
  };

  string customer_id = 1;
  string address_id = 2;
  Address address = 3;
}

message DeleteCustomerRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"customer_id\": \"0cf361e1-4b44-483d-a159-54dabdf7e814\"}"
    };

    string customer_id = 1;
} 

message DeleteCustomerAddressRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"customer_id\": \"0cf361e1-4b44-483d-a159-54dabdf7e814\", \"address_id\": \"e8d58539-a66e-4996-a92c-64c450086c8a\" }"
    };

    string customer_id = 1;
    string address_id = 2;
} 

