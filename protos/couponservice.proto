syntax = "proto3";

package ihavefood;

option go_package =  "/genproto";

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "protoc-gen-openapiv2/options/annotations.proto";



// ---------------------COUPON SERVICE-----------------------------
// Manages coupons.
service CouponService {

    //ListCoupons shows all coupons.
    rpc ListCoupons(google.protobuf.Empty) returns(ListCouponsResponse){
        option (google.api.http) = {
            get: "/api/coupons" 
        };
    }

    // GetCoupon shows a valid coupon by code.
    rpc GetCoupon(GetCouponRequest) returns(Coupon) {
        option (google.api.http) = {
            get: "/api/coupons/{code}" 
        };
    }

    rpc AddCoupon(AddCouponRequest) returns(Coupon){
        option (google.api.http) = {
            post: "/api/coupons"
            body: "*"
        };
    }

    // RedeemCoupon updates coupon quantity after an order is paid.
    rpc RedeemCoupon(RedeemCouponRequest) returns (google.protobuf.Empty){}
}

message Coupon {
    string code = 1;
    // The coupon expiration time in hours from now.
    // For example expire_in_hour is 72 means the coupon will be expired
    // in 3 days (72 hours) from now.
    int64 expires_in_hour = 2;
    int32 quantity_count = 3;
    oneof coupon_details {
        PercentDiscount percent_discount = 4;
        FreeDelivery free_delivery = 5;
    }
}

message PercentDiscount {
    int32 percent = 1; // 1-100
}
message FreeDelivery {}

message AddCouponRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      json_schema: {
        description: "Specify exactly one of: percent_discount or free_delivery"
      };
    };
    
    int32 expire_in_hour = 1;
    int32 quantity = 2;
    oneof discount_type {
        PercentDiscount percent_discount = 3;
        FreeDelivery free_delivery = 4;
    }
}

message GetCouponRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"code\": \"SAVE20\"}"
    };
    string code = 1;
}

message ListCouponsResponse {
    repeated Coupon coupons = 1;
}

message RedeemCouponRequest {
    string code = 1;
}





