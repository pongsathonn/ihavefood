syntax = "proto3";

package ihavefood;

option go_package =  "/genproto";

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";
import "protoc-gen-openapiv2/options/annotations.proto";

// ---------------------AUTH SERVICE------------------------------
// Manages auth credentials
service AuthService {

    // Create a new auth credential (customer, merchant, rider) using one endpoint.
    rpc Register(RegisterRequest) returns(AuthCredentials) {
        option (google.api.http) = {
            post: "/auth/register" 
            body: "*"
        };
        option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
            security: { } // Disable security key
        };
    }

    // Login sign in as customer, rider
    rpc Login(LoginRequest) returns(LoginResponse){
        option (google.api.http) = {
            post: "/auth/login" 
            body: "*"
        };
        option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
            security: { } // Disable security key
        };
    }

    rpc UpdatePhoneNumber(UpdatePhoneNumberRequest) returns (UpdatePhoneNumberResponse){
        option (google.api.http) = {
            patch: "/auth/{auth_id}/phone-number" 
            body: "*"
        };
    }

    // verify token for role "customer,merchant,rider" returns true if token valid, otherwise false.
    rpc VerifyUserToken(VerifyUserTokenRequest) returns(VerifyUserTokenResponse) {}

    // verify token for role "admin,superadmin" returns true if token valid, otherwise false.
    rpc VerifyAdminToken(VerifyAdminTokenRequest) returns (VerifyAdminTokenResponse){}

    // CreateAdmin required super admin role.
    // rpc CreateAdmin(CreateAdminRequest) returns(UserCredentials){
    //     option (google.api.http) = {
    //         post: "/auth/admin" 
    //         body: "*"
    //     };
    // }

    /*
        rpc ForgotPassword(ForgotPasswordRequest) returns(ForgotPasswordResponse) {}
    */
}

message AuthCredentials {
    string id = 1;
    string email = 2;
    string phone = 3;
    Roles role = 4;
    google.protobuf.Timestamp create_time = 5;
    google.protobuf.Timestamp update_time = 6;
}

enum Roles {
    UNKNOWN = 0;
    CUSTOMER = 1;
    RIDER = 3;

    // For simplicity, admin roles are included in this enum.
    SUPER_ADMIN = 20;
    ADMIN = 21;
}


message RegisterRequest {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
  example: "{\"email\": \"somsak@example.com\", \"password\": \"Newpa$sword9\", \"role\": \"CUSTOMER\"}"
  };
  string email = 1;
  string password = 2;
  Roles role = 3;
}

message LoginRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
        example: "{\"identifier\": \"somsak22@mail.com\", \"password\": \"Newpa$sword9\",\"role\": \"CUSTOMER\"}"
    };

    // Email, or Phone number
    string identifier = 1;  
    string password = 2;
    Roles role = 3;
}

message LoginResponse {
    // Access token. Valid for 30 days.
    string access_token = 1;
    // Number of seconds until the access token expires.
    int64 expires_in = 2;
}

message UpdatePhoneNumberRequest {
  string auth_id = 1;
  string new_phone = 2;
}
message UpdatePhoneNumberResponse {
  AuthCredentials auth = 1;
}

message VerifyUserTokenRequest {
    string access_token = 1;
}

message VerifyUserTokenResponse {
    bool valid = 1;
}

message VerifyAdminTokenRequest {
    string access_token = 1;
}

message VerifyAdminTokenResponse {
    bool valid = 1;
}

// message CreateAdminRequest {
//    string email = 2;
//    string password = 3;
//    string phone = 4;
// }
//
