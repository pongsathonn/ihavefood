syntax = "proto3";

package ihavefood;

option go_package =  "/genproto";

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "common.proto";
import "protoc-gen-openapiv2/options/annotations.proto";

// ---------------------MERCHANT SERVICE------------------------
service MerchantService {

    rpc ListMerchants(google.protobuf.Empty) returns(ListMerchantsResponse){
        option (google.api.http) = {
            get: "/api/merchants" 
        };
    }
    rpc GetMerchant(GetMerchantRequest) returns(Merchant){
        option (google.api.http) = {
            get: "/api/merchants/{merchant_id}" 
        };
    }

    rpc CreateMerchant(CreateMerchantRequest) returns(Merchant) {
        option (google.api.http) = {
            post: "/api/merchants"
            body: "*"
        };
    }

    rpc UpdateMerchant(UpdateMerchantRequest) returns(Merchant) {
        option (google.api.http) = {
            patch: "/api/merchants/{merchant_id}"
            body: "*"
        };
    }

    rpc CreateMenu(CreateMenuRequest) returns(CreateMenuResponse) {
        option (google.api.http) = {
            post: "/api/merchants/{merchant_id}/menu"
            body: "*"
        };
    }

    rpc UpdateMenuItem(UpdateMenuItemRequest) returns(MenuItem) {
        option (google.api.http) = {
            patch: "/api/merchants/{merchant_id}/menu/items/{item_id}"
            body: "*"
        };
    }

    // Store Management
    rpc UpdateStoreStatus(UpdateStoreStatusRequest) returns (StoreStatusResponse);
    rpc GetStoreStatus(GetStoreStatusRequest) returns (StoreStatusResponse);
}

enum StoreStatus{
    STATUS_UNSPECIFIED = 0;
    CLOSED = 1;
    OPEN = 2;
}

message Merchant {
    string merchant_id = 1;
    string merchant_name = 2;
    repeated MenuItem menu = 3;
    ImageInfo image_info = 8;
    Address address = 4;
    string phone = 5;
    string email = 6;
    StoreStatus status = 7;
}

message MenuItem {
    string item_id = 1;
    string food_name = 2;
    int32 price = 3;
    ImageInfo image_info = 4;
}

message ImageInfo {
  string url = 1;
  // MIME type: image/jpeg, image/png
  string type = 2;
}

message NewMenuItem {
    string food_name = 1;
    int32 price = 2;
    ImageInfo image_info = 3;
}

message GetMerchantRequest{
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"merchant_id\": \"a1b2c3d4-5678-90ab-cdef-1234567890ab\"}"
    };
    string merchant_id = 1;
}

message CreateMerchantRequest {
    string merchant_name = 1;
    repeated NewMenuItem menu = 2;
    NewAddress address = 3;
    string phone = 4;
    string email = 5;
    ImageInfo image_info = 8;
    StoreStatus status = 7;
}

message ListMerchantsResponse{
    repeated Merchant merchants = 1;
}

message UpdateMerchantRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"merchant_id\":\"m1234567-89ab-cdef-0123-456789abcdef\",\"new_merchant_name\":\"Jaidee Tamsung 2\",\"new_address\":{\"address_name\":\"Second Branch\",\"sub_district\":\"Nimman\",\"district\":\"Mueang Chiang Mai\",\"province\":\"Chiang Mai\",\"postal_code\":\"50200\"}}"
    };

    string merchant_id = 1 ;
    string new_merchant_name = 2;
    Address new_address = 3;
}

message CreateMenuRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"merchant_id\":\"m1234567-89ab-cdef-0123-456789abcdef\",\"new_menu\":[{\"food_name\":\"Khai Jiao\",\"price\":50,\"image_info\":{\"url\":\"http://localhost/images/khai_jiao.png\",\"type\":\"image/png\"}},{\"food_name\":\"Pad Thai\",\"price\":60,\"image_info\":{\"url\":\"http://localhost/images/pad_thai.png\",\"type\":\"image/png\"}},{\"food_name\":\"Kra Prao Moo Sub\",\"price\":70,\"image\":{\"url\":\"http://localhost/images/kra_prao_moo_sub.png\",\"type\":\"image/jpeg\"}},{\"food_name\":\"Khao Pad Goong\",\"price\":80,\"image_info\":{\"url\":\"http://localhost/images/khao_pad_goong.png\",\"type\":\"image/jpeg\"}}]}"
    };

    string merchant_id = 1;
    repeated NewMenuItem new_menu = 2;
}

message CreateMenuResponse {
  repeated MenuItem menu = 1;
}

message UpdateMenuItemRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"merchant_id\":\"m1234567-89ab-cdef-0123-456789abcdef\",\"item_id\":\"a1111111-1111-1111-1111-111111111111\",\"food_name\":\"Khai Jiao\",\"price\":55,\"is_available\":true}"
    };

    string merchant_id = 1;
    string item_id = 2;
    string food_name = 3;
    int32 price = 4;
    bool is_available = 6;
}

message UpdateStoreStatusRequest {
    string merchant_id = 1;
    StoreStatus status = 2;
}

message GetStoreStatusRequest {
    string merchant_id = 1;
}
message StoreStatusResponse {
    string merchant_id = 1;
    StoreStatus status = 2;
}
