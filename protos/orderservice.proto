syntax = "proto3";

package ihavefood;

option go_package =  "/genproto";

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";
import "common.proto";
import "customerservice.proto";
import "protoc-gen-openapiv2/options/annotations.proto";


// ---------------------ORDER SERVICE------------------------------
// Manages place order process.
service OrderService {

    //  ListOrderHistory retrives Customer's place order history by CustomerID
    rpc ListOrderHistory(ListOrderHistoryRequest) returns (ListOrderHistoryResponse){
        option (google.api.http) = { get: "/api/orders/{customer_id}" };
    }

    // rpc GetPlaceOrder(id) returns(order){}

    rpc CreatePlaceOrder(CreatePlaceOrderRequest) returns(PlaceOrder){
        option (google.api.http) = {
            post: "/api/orders/place_order" 
            body: "*"
        };
    }

}

message PlaceOrder {
    // request_id for idempotency.
    string request_id = 1;
    string order_id = 2 ;
    string customer_id = 3;
    string merchant_id = 4;
    repeated OrderItem items = 5;
    string coupon_code = 6;
    int32 coupon_discount =7;
    int32 delivery_fee = 8;
    int32 total = 9;
    Address customer_address = 10;
    Address merchant_address = 11;
    ContactInfo customer_contact = 12;
    PaymentMethods payment_methods = 13;
    PaymentStatus payment_status = 14;
    OrderStatus order_status = 15;
    OrderTimestamps order_timestamps = 16;
}

message OrderItem {
    string item_id = 1;
    int32 quantity = 2;
    string note = 3;
}

enum PaymentMethods {
    PAYMENT_METHOD_UNSPECIFIED = 0;
    PAYMENT_METHOD_CASH = 1;
    PAYMENT_METHOD_CREDIT_CARD = 2; 
    PAYMENT_METHOD_PROMPT_PAY = 3;
}

enum PaymentStatus {
    UNPAID = 0;
    PAID = 1;
}

enum OrderStatus {
    PENDING = 0;   
    PREPARING_ORDER =1;
    FINDING_RIDER =2;
    WAIT_FOR_PICKUP = 3; 
    ONGOING = 4;
    DELIVERED =5;
    CANCELLED =6;
}

message OrderTimestamps {
    google.protobuf.Timestamp create_time = 1;
    google.protobuf.Timestamp update_time = 2;
    google.protobuf.Timestamp complete_time = 3;
}

message ListOrderHistoryRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"customer_id\":\"0cf361e1-4b44-483d-a159-54dabdf7e814\"}"
    };

    string customer_id = 1;
}

message ListOrderHistoryResponse {
    repeated PlaceOrder place_orders = 1;
}

message CreatePlaceOrderRequest {
    string request_id = 1;
    string customer_id = 2;
    string merchant_id = 3;
    repeated OrderItem items = 4;
    string coupon_code = 5;
    string customer_address_id = 6;
    PaymentMethods payment_methods = 7;
}

