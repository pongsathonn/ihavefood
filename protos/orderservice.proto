syntax = "proto3";

package ihavefood;

option go_package =  "/genproto";

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";
import "common.proto";
import "protoc-gen-openapiv2/options/annotations.proto";

// ---------------------ORDER SERVICE------------------------------
// Manages place order process.
service OrderService {

    //  ListOrderHistory retrives Customer's place order history by CustomerID
    rpc ListOrderHistory(ListOrderHistoryRequest) returns (ListOrderHistoryResponse){
        option (google.api.http) = { get: "/api/orders/{customer_id}" };
    }

    // rpc GetPlaceOrder(id) returns(order){}

    rpc CreatePlaceOrder(CreatePlaceOrderRequest) returns(PlaceOrder){
        option (google.api.http) = {
            post: "/api/orders/place_order" 
            body: "*"
        };
    }

}

message PlaceOrder {
    // request_id for idempotency.
    string request_id = 1;
    string order_id = 2 ;
    string customer_id = 3;
    string merchant_id = 4;
    repeated OrderItem items = 5;
    string coupon_code = 6;
    int32 coupon_discount =7;
    int32 delivery_fee = 8;
    int32 total = 9;
    Address customer_address = 10;
    Address merchant_address = 11;
    string customer_phone = 12;
    PaymentMethods payment_methods = 13;
    PaymentStatus payment_status = 14;
    OrderStatus order_status = 15;
    OrderEventTimestamps timestamps = 16;
}

message OrderItem {
    string item_id = 1;
    int32 quantity = 2;
    string note = 3;
}

enum PaymentMethods {
    PAYMENT_METHOD_UNSPECIFIED = 0;
    PAYMENT_METHOD_CASH = 1;
    PAYMENT_METHOD_CREDIT_CARD = 2; 
    PAYMENT_METHOD_PROMPT_PAY = 3;
}

enum PaymentStatus {
    PAYMENT_STATUS_UNSPECIFIED = 0;
    PAYMENT_STATUS_PENDING = 1;
    PAYMENT_STATUS_PAID = 2;
}

enum OrderStatus {
    ORDER_STATUS_UNSPECIFIED = 0;   
    ORDER_STATUS_PENDING = 1;   
    ORDER_STATUS_PREPARING_ORDER = 2;
    ORDER_STATUS_FINDING_RIDER = 3;
    ORDER_STATUS_WAIT_FOR_PICKUP = 4; 
    ORDER_STATUS_ONGOING = 5;
    ORDER_STATUS_DELIVERED =6;
    ORDER_STATUS_CANCELLED =7;
}

message OrderEventTimestamps {
    google.protobuf.Timestamp order_placed_time = 1;
    google.protobuf.Timestamp merchant_accept_time = 2;
    google.protobuf.Timestamp rider_notified_time = 3;
    google.protobuf.Timestamp rider_assigned_time = 4;
    google.protobuf.Timestamp rider_picked_up_time = 5;
    google.protobuf.Timestamp delivered_time = 6;
    google.protobuf.Timestamp cancelled_time = 7;

}

message ListOrderHistoryRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"customer_id\":\"0cf361e1-4b44-483d-a159-54dabdf7e814\"}"
    };

    string customer_id = 1;
}

message ListOrderHistoryResponse {
    repeated PlaceOrder place_orders = 1;
}

message CreatePlaceOrderRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
      example: "{\"request_id\":\"cee942b9-5ae7-4511-9717-5e6a9d10ece2\",\"customer_id\":\"f7407f59-3904-495b-b7d1-c15dbbb723e3\",\"merchant_id\":\"422fe523-b6a0-4ff0-8cb5-aa6c65c29285\",\"items\":[{\"item_id\":\"874ae56c-730a-43cd-a0d6-96e8f0ccdad7\",\"quantity\":2,\"note\":\"no spice\"},{\"item_id\":\"28cf88d0-a31c-41b7-8c0e-e85e6344a99d\",\"quantity\":1,\"note\":\"extra egg\"}],\"coupon_code\":\"DISCOUNT10\",\"discount\":10,\"customer_address_id\":\"c912f252-4ceb-49e8-82eb-63ea6a61b8a2\",\"payment_methods\":\"PAYMENT_METHOD_CREDIT_CARD\"}"
    };
    string request_id = 1;
    string customer_id = 2;
    string merchant_id = 3;
    repeated OrderItem items = 4;
    string coupon_code = 5;
    int32 discount =6;
    string customer_address_id = 7;
    PaymentMethods payment_methods = 8;
}

